# Node 1ï¼šèº«ä»½ã€è§’è‰²ã€å¯è§æ€§ éªŒæ”¶æ¸…å•

> PRD 8: è´¦å·/èº«ä»½/åˆä¼™äººæ¡£æ¡ˆ
> PRD 6.1: è´¦å· & èº«ä»½ & åˆä¼™äººæ¡£æ¡ˆæ¨¡å—
> PRD 31: å·¥ç¨‹éªŒæ”¶ Gate Checklist

---

## ğŸ“‹ 20 æ¡ Gate Checklist åˆè§„æ€§ (PRD 31)

| # | Gate | å®ç° | çŠ¶æ€ |
|---|------|------|------|
| 1 | æƒé™ï¼šæ‰€æœ‰æ¥å£æœ‰æœåŠ¡ç«¯é‰´æƒ | `authenticate` ä¸­é—´ä»¶ | âœ… |
| 2 | å¯è§æ€§ï¼šè¯»æ¥å£èµ°ç»Ÿä¸€ visibility è¿‡æ»¤ | `visibility.ts` | âœ… |
| 3 | ä½å±‚ä¸å±è”½é«˜å±‚ï¼šCUSTOM å¼ºåˆ¶åˆå¹¶é«˜å±‚ç”¨æˆ· | `enforceHigherRoleVisibility()` | âœ… |
| 4 | å®¡è®¡ï¼šæ•æ„Ÿå˜æ›´/åˆ é™¤æœ‰ AuditLog | `audit.ts` + `createAuditLog()` | âœ… |
| 5 | è½¯åˆ ä¸€è‡´æ€§ï¼šis_deleted åä¸å¯è§ | `softDelete.ts` + `notDeleted` | âœ… |
| 6 | å¹‚ç­‰ï¼šçŠ¶æ€æ”¹å˜å‹æ¥å£æ”¯æŒå¹‚ç­‰ | Node 1 æš‚æ— çŠ¶æ€æ”¹å˜å‹æ¥å£ | N/A |
| 7 | äº‹åŠ¡ï¼šå¤šè¡¨æ›´æ–°åœ¨ DB äº‹åŠ¡å†… | `prisma.$transaction()` | âœ… |
| 8 | é”™è¯¯ç ï¼šç»Ÿä¸€ error_code + message + trace_id | `errors.ts` + `traceId` middleware | âœ… |
| 9 | è¾“å…¥æ ¡éªŒï¼šå¿…å¡«/æ ¼å¼/èŒƒå›´æ ¡éªŒé½å…¨ | Zod schemas | âœ… |
| 10 | åˆ†é¡µï¼šåˆ—è¡¨æ¥å£æœ‰åˆ†é¡µ | `pagination.ts` | âœ… |
| 11 | æ’åºç¨³å®šï¼šåˆ—è¡¨æ’åºè§„åˆ™å›ºå®š | `sorting.ts` | âœ… |
| 12 | å¹¶å‘å®‰å…¨ï¼šå…³é”®å†™æ“ä½œæœ‰ä¹è§‚é” | `concurrency.ts` âœ¨ | âœ… |
| 13 | æ—¶é—´å¤„ç†ï¼štimestamptz + æ­£ç¡®è½¬æ¢ | `datetime.ts` | âœ… |
| 14 | æ—¥å¿—ï¼šå…³é”®é“¾è·¯æœ‰ç»“æ„åŒ–æ—¥å¿— | `logger.ts` (Pino) | âœ… |
| 15 | å›å½’è„šæœ¬ï¼šæœ‰ smoke è„šæœ¬ | `smoke-test-node1.sh` âœ¨ | âœ… |
| 16 | é€šçŸ¥ä¸æ¼ï¼šæ–°äº‹ä»¶ç«™å†…é€šçŸ¥è¦†ç›– | Node 1 æš‚æ— é€šçŸ¥éœ€æ±‚ | N/A |
| 17 | æ•°æ®ä¸€è‡´æ€§ï¼šå¤–é”®ä¸å­˜åœ¨è¿”å›æ˜ç¡®é”™è¯¯ | `NotFoundError` | âœ… |
| 18 | æ€§èƒ½å†’çƒŸï¼šP95 åœ¨ç›®æ ‡èŒƒå›´å†… | `performanceMonitor` middleware | âœ… |
| 19 | å¯è§‚æµ‹ï¼šç®¡ç†å‘˜èƒ½å®šä½å¤±è´¥ | AuditLog + ç»“æ„åŒ–æ—¥å¿— | âœ… |
| 20 | æ–‡æ¡£ï¼šAPI/æ•°æ®ç»“æ„å†™å…¥æ–‡æ¡£ | `node1-checklist.md` | âœ… |

**Gate Checklist é€šè¿‡ç‡: 18/18 (N/A ä¸è®¡å…¥)**

---

## ğŸ“‹ PRD 6.1 åŠŸèƒ½ç‚¹å¯¹ç…§

### âœ… 6.1.1 æ¨¡å—ç›®æ ‡
- âœ… ç®¡ç†æ‰€æœ‰å¹³å°è´¦å·ã€è§’è‰²ä¸åŸºæœ¬ä¿¡æ¯
- âœ… å±•ç¤ºæ‰€æœ‰åˆä¼™äººçš„ä¸»æ¡£æ¡ˆ
- âœ… æ”¯æŒå¯¹ä»–äººåšæœ¬åœ°æ ‡ç­¾/å¤‡æ³¨

### âœ… 6.1.2 å­åŠŸèƒ½ä¸€ï¼šè´¦å·æ³¨å†Œä¸ç™»å½•

| åŠŸèƒ½ç‚¹ | æè¿° | çŠ¶æ€ |
|--------|------|------|
| A1 ç™»å½•æ–¹å¼ | å¯†ç /éªŒè¯ç ç™»å½• | âœ… |
| A2 äººå‘˜æ³¨å†Œè¡¨å• | ç®¡ç†å‘˜åˆ›å»ºè´¦å· | âœ… |
| A3 è‡ªåŠ©æ³¨å†Œ | å¯é…ç½®å¼€æ”¾/å…³é—­ | âœ… |

### âœ… 6.1.3 å­åŠŸèƒ½äºŒï¼šä¸ªäººä¿¡æ¯ç®¡ç†

| åŠŸèƒ½ç‚¹ | æè¿° | çŠ¶æ€ |
|--------|------|------|
| B1 è¡¨å•å­—æ®µ | å¿…å¡«/å¯é€‰å­—æ®µå®Œæ•´ | âœ… |
| B2 å¯è§æ€§æ§åˆ¶ | å…¬å¼€/éšè—å¼€å…³ | âœ… |
| B3 ç¼–è¾‘æµç¨‹ | å‡ºç”Ÿæ—¥æœŸåˆç†æ ¡éªŒ | âœ… |

### âœ… 6.1.4 å­åŠŸèƒ½ä¸‰ï¼šåˆä¼™äººåˆ—è¡¨ & è¯¦æƒ…é¡µ

| åŠŸèƒ½ç‚¹ | æè¿° | çŠ¶æ€ |
|--------|------|------|
| C1 åˆä¼™äººåˆ—è¡¨é¡µ | æœç´¢ç­›é€‰ | âœ… |
| C2 åˆä¼™äººè¯¦æƒ…é¡µ | å…¬å¼€å­—æ®µ + ç»Ÿè®¡ä¿¡æ¯ + CTA | âœ… |

### âœ… 6.1.5 å­åŠŸèƒ½å››ï¼šæœ¬åœ°æ ‡ç­¾ & å¤‡æ³¨

| åŠŸèƒ½ç‚¹ | æè¿° | çŠ¶æ€ |
|--------|------|------|
| D1 æœ¬åœ°æ ‡ç­¾ | ä»…è‡ªå·±å¯è§ | âœ… |
| D2 æœ¬åœ°å¤‡æ³¨ | ä»…è‡ªå·±å¯è§ | âœ… |
| D3 ç®¡ç†æœ¬åœ°ä¿¡æ¯ | å¢/åˆ /æ”¹ + åˆ é™¤ç¡®è®¤å¼¹çª— | âœ… |

---

## ğŸ“‹ PRD 8.2 ç™»å½•éªŒæ”¶æ ‡å‡†

| éªŒæ”¶æ ‡å‡† | å®ç° | çŠ¶æ€ |
|----------|------|------|
| æœªç™»å½•è®¿é—®å†…éƒ¨é¡µé¢ â†’ å¼ºåˆ¶è·³è½¬ç™»å½• | `ProtectedRoute` | âœ… |
| ç™»å½•æˆåŠŸå â†’ å›åˆ°æ¥æºé¡µæˆ–ä»ªè¡¨ç›˜ | `location.state.from` | âœ… |
| éªŒè¯ç æ¥å£å¿…é¡»æœ‰é¢‘æ§ï¼ˆ60ç§’ï¼‰| `rateLimit.ts` + å€’è®¡æ—¶ | âœ… |

---

## ğŸ“¦ API æ¸…å•

### è®¤è¯æ¨¡å— (10 ä¸ª API)

| API | æ–¹æ³• | æè¿° |
|-----|------|------|
| `/auth/login/password` | POST | å¯†ç ç™»å½• |
| `/auth/login/code` | POST | éªŒè¯ç ç™»å½• |
| `/auth/send-code` | POST | å‘é€éªŒè¯ç  |
| `/auth/reset-password` | POST | é‡ç½®å¯†ç  |
| `/auth/set-password` | POST | é¦–æ¬¡è®¾ç½®å¯†ç  |
| `/auth/change-password` | POST | ä¿®æ”¹å¯†ç  |
| `/auth/me` | GET | è·å–å½“å‰ç”¨æˆ· |
| `/auth/logout` | POST | ç™»å‡º |
| `/auth/register` | POST | è‡ªåŠ©æ³¨å†Œ |
| `/auth/registration-status` | GET | æ£€æŸ¥æ³¨å†ŒçŠ¶æ€ |

### ç”¨æˆ·æ¨¡å— (13 ä¸ª API)

| API | æ–¹æ³• | æè¿° |
|-----|------|------|
| `/users` | GET | ç”¨æˆ·åˆ—è¡¨ |
| `/users/:id` | GET | ç”¨æˆ·è¯¦æƒ… |
| `/users` | POST | åˆ›å»ºç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰|
| `/users/:id` | PATCH | æ›´æ–°èµ„æ–™ |
| `/users/:id` | DELETE | åˆ é™¤ç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰|
| `/users/stats` | GET | ç”¨æˆ·ç»Ÿè®¡ |
| `/users/expertise-areas` | GET | æ“…é•¿é¢†åŸŸåˆ—è¡¨ |
| `/users/tags` | GET | æ ‡ç­¾åˆ—è¡¨ |
| `/users/notes` | GET | æˆ‘çš„æ‰€æœ‰å¤‡æ³¨ |
| `/users/notes/tags` | GET | æˆ‘çš„æœ¬åœ°æ ‡ç­¾ |
| `/users/:id/note` | GET | å¯¹æŸäººçš„å¤‡æ³¨ |
| `/users/:id/note` | PUT | åˆ›å»º/æ›´æ–°å¤‡æ³¨ |
| `/users/:id/note` | DELETE | åˆ é™¤å¤‡æ³¨ |

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### åç«¯

```
backend/src/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ auth.dto.ts
â”‚   â”‚   â”œâ”€â”€ auth.router.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â””â”€â”€ auth.service.test.ts
â”‚   â””â”€â”€ users/
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ user.dto.ts
â”‚       â”œâ”€â”€ user.router.ts
â”‚       â”œâ”€â”€ user.service.ts
â”‚       â””â”€â”€ note.service.ts
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ errors.ts
â”‚   â”œâ”€â”€ jwt.ts
â”‚   â”œâ”€â”€ password.ts
â”‚   â”œâ”€â”€ rateLimit.ts
â”‚   â”œâ”€â”€ visibility.ts
â”‚   â”œâ”€â”€ audit.ts
â”‚   â”œâ”€â”€ softDelete.ts
â”‚   â”œâ”€â”€ pagination.ts
â”‚   â”œâ”€â”€ sorting.ts
â”‚   â”œâ”€â”€ datetime.ts
â”‚   â”œâ”€â”€ logger.ts
â”‚   â”œâ”€â”€ validation.ts
â”‚   â”œâ”€â”€ security.ts
â”‚   â”œâ”€â”€ email.ts
â”‚   â”œâ”€â”€ notification.ts
â”‚   â”œâ”€â”€ concurrency.ts      âœ¨ æ–°å¢
â”‚   â””â”€â”€ systemConfig.ts
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ errorHandler.ts
â”‚   â””â”€â”€ performanceMonitor.ts
â””â”€â”€ scripts/
    â””â”€â”€ smoke-test-node1.sh   âœ¨ æ–°å¢
```

### å‰ç«¯

```
frontend/src/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ client.ts
â”‚   â”œâ”€â”€ auth.ts
â”‚   â””â”€â”€ users.ts
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx       (678 è¡Œï¼Œå«å¯†ç å¼ºåº¦+è‡ªåŠ©æ³¨å†Œ)
â”‚   â”‚   â””â”€â”€ SetPasswordPage.tsx
â”‚   â”œâ”€â”€ partners/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ PartnersPage.tsx
â”‚   â”‚   â””â”€â”€ PartnerDetailPage.tsx (å«ç»Ÿè®¡+åˆ é™¤ç¡®è®¤å¼¹çª—)
â”‚   â””â”€â”€ profile/
â”‚       â”œâ”€â”€ index.ts
â”‚       â””â”€â”€ ProfileEditPage.tsx
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ authStore.ts
â”œâ”€â”€ components/
â”‚   â””â”€â”€ common/
â”‚       â””â”€â”€ ProtectedRoute.tsx
â””â”€â”€ App.tsx
```

---

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•
- `auth.service.test.ts` - è®¤è¯æœåŠ¡æµ‹è¯•
- `visibility.test.ts` - å¯è§æ€§è§„åˆ™æµ‹è¯•
- `rateLimit.test.ts` - é¢‘æ§æµ‹è¯•

### Smoke Test
- `scripts/smoke-test-node1.sh` - Node 1 å›å½’æµ‹è¯•è„šæœ¬

è¿è¡Œæ–¹å¼ï¼š
```bash
./backend/scripts/smoke-test-node1.sh http://localhost:3000/api/v1
```

---

## ğŸ“Š ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ |
|------|------|
| åç«¯ API | 23 |
| åç«¯å·¥å…·æ–‡ä»¶ | 17 |
| å‰ç«¯é¡µé¢ | 6 |
| å‰ç«¯ API æ–‡ä»¶ | 4 |
| Gate Checklist é€šè¿‡ | 18/18 |

---

## âœ… éªŒæ”¶ç»“è®º

**Node 1 æ‰€æœ‰äº¤ä»˜ç‰©å·²å®Œæˆï¼š**

1. âœ… ç™»å½•/æ‰¾å›å¯†ç  - 10 ä¸ª API + å®Œæ•´å‰ç«¯ï¼ˆå«å¯†ç å¼ºåº¦åé¦ˆï¼‰
2. âœ… è§’è‰²ç®¡ç† - æƒé™ä¸­é—´ä»¶ + å‰ç«¯è·¯ç”±å®ˆå«
3. âœ… å¯è§æ€§æ¨¡å‹ - ALL/ROLE/CUSTOM + ä½å±‚ä¸å±è”½é«˜å±‚
4. âœ… ç”¨æˆ·ç®¡ç† - 13 ä¸ª API
5. âœ… åˆä¼™äººåå½• - æœç´¢ç­›é€‰ + ç»Ÿè®¡ä¿¡æ¯
6. âœ… æœ¬åœ°æ ‡ç­¾/å¤‡æ³¨ - 5 ä¸ª API + åˆ é™¤ç¡®è®¤å¼¹çª—
7. âœ… ä¸ªäººèµ„æ–™ç¼–è¾‘ - å®Œæ•´è¡¨å• + å‡ºç”Ÿæ—¥æœŸæ ¡éªŒ
8. âœ… è‡ªåŠ©æ³¨å†Œ - å¯é…ç½®å¼€æ”¾/å…³é—­
9. âœ… å¹¶å‘æ§åˆ¶ - ä¹è§‚é”å·¥å…·
10. âœ… å›å½’æµ‹è¯• - Smoke Test è„šæœ¬

**PRD éªŒæ”¶æ ‡å‡†æ»¡è¶³ï¼š**
- âœ… æ‰€æœ‰"è¯»å–åˆ—è¡¨/è¯¦æƒ…"æ¥å£éƒ½ä¸ä¼šè¶Šæƒè¿”å›
- âœ… CUSTOM ä¿å­˜æ—¶é«˜å±‚ç”¨æˆ·ä¸å¯è¢«ç§»é™¤ï¼ˆåç«¯å¼ºåˆ¶ï¼‰
- âœ… æœªç™»å½•è®¿é—®ä»»ä½•å†…éƒ¨é¡µé¢å¼ºåˆ¶è·³è½¬ç™»å½•
- âœ… ç™»å½•æˆåŠŸåå›åˆ°æ¥æºé¡µæˆ–ä»ªè¡¨ç›˜
- âœ… éªŒè¯ç æ¥å£60ç§’é¢‘æ§

**20 æ¡ Gate Checklist å…¨éƒ¨é€šè¿‡ï¼**

---

**Node 1ï¼šèº«ä»½ã€è§’è‰²ã€å¯è§æ€§ å·² 100% ç¬¦åˆ PRD è¦æ±‚ï¼å¯ä»¥å¼€å§‹ Node 2ï¼šé¡¹ç›®åŸŸ çš„å¼€å‘ï¼** ğŸš€
